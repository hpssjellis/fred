<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flappy Gem</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a202c;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            color: white;
            padding: 1rem;
        }

        .game-container {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            border-radius: 1rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            padding: 1rem;
            background-color: #2d3748;
        }

        canvas {
            border-radius: 0.75rem;
            background-color: #4a5568;
            border: 2px solid #a0aec0;
        }

        #message-box {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #2c5282;
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            text-align: center;
            z-index: 10;
        }

        .button {
            padding: 0.5rem 1rem;
            background-color: #4299e1;
            color: white;
            border-radius: 0.5rem;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s;
            border: none;
        }
        
        .button:hover {
            background-color: #63b3ed;
        }
    </style>
</head>
<body class="bg-gray-900 text-white flex items-center justify-center p-4">
    <div class="game-container max-w-lg w-full">
        <h1 class="text-3xl font-bold mb-4">Flappy Gem</h1>
        <canvas id="gameCanvas" class="w-full h-auto" width="320" height="480"></canvas>
        <div class="score-display mt-4 text-xl">
            Score: <span id="score">0</span>
        </div>

        <!-- Message Box -->
        <div id="message-box" class="hidden">
            <h2 id="message-title" class="text-2xl font-bold mb-2">Game Over</h2>
            <p id="message-text" class="text-lg mb-4">You crashed! Click below to try again.</p>
            <button id="restartButton" class="button">Restart Game</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const canvas = document.getElementById('gameCanvas');
            const ctx = canvas.getContext('2d');
            const scoreDisplay = document.getElementById('score');
            const messageBox = document.getElementById('message-box');
            const messageTitle = document.getElementById('message-title');
            const messageText = document.getElementById('message-text');
            const restartButton = document.getElementById('restartButton');

            let requestId;

            // Define game variables
            const GAME_WIDTH = 320;
            const GAME_HEIGHT = 480;

            // Player (Gem) properties
            const gem = {
                x: 50,
                y: 240,
                radius: 15,
                velocity: 0,
                gravity: 0.25,
                jumpPower: -5,
                color: '#63b3ed',
                draw() {
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                    ctx.fillStyle = this.color;
                    ctx.fill();
                    ctx.closePath();
                },
                update() {
                    this.velocity += this.gravity;
                    this.y += this.velocity;
                    // Keep the gem within the vertical bounds of the canvas
                    if (this.y + this.radius > GAME_HEIGHT) {
                        this.y = GAME_HEIGHT - this.radius;
                        this.velocity = 0;
                        gameState.isGameOver = true;
                    }
                    if (this.y - this.radius < 0) {
                        this.y = this.radius;
                        this.velocity = 0;
                        gameState.isGameOver = true;
                    }
                }
            };

            // Obstacle (Crystal) properties
            class Crystal {
                constructor(x, gapY, gapHeight, width, speed) {
                    this.x = x;
                    this.gapY = gapY;
                    this.gapHeight = gapHeight;
                    this.width = width;
                    this.speed = speed;
                    this.color = '#a0aec0';
                    this.isPassed = false;
                }
                draw() {
                    // Top crystal
                    ctx.fillStyle = this.color;
                    ctx.fillRect(this.x, 0, this.width, this.gapY);

                    // Bottom crystal
                    ctx.fillRect(this.x, this.gapY + this.gapHeight, this.width, GAME_HEIGHT - (this.gapY + this.gapHeight));
                }
                update() {
                    this.x -= this.speed; // Move left
                }
            }

            // Game state object
            const gameState = {
                score: 0,
                crystals: [],
                isGameOver: false,
                isGameStarted: false,
                crystalTimer: 0,
                // Initial game difficulty settings
                initialInterval: 120, // Frames
                baseSpeed: 2,
                reset() {
                    this.score = 0;
                    this.crystals = [];
                    this.isGameOver = false;
                    this.isGameStarted = false;
                    this.crystalTimer = 0;
                    gem.y = 240;
                    gem.velocity = 0;
                }
            };

            // Main game loop
            function gameLoop() {
                if (gameState.isGameOver) {
                    messageTitle.textContent = "Game Over!";
                    messageText.textContent = `You scored: ${gameState.score}! Click below to try again.`;
                    messageBox.classList.remove('hidden');
                    return;
                }

                // Update game state
                ctx.clearRect(0, 0, GAME_WIDTH, GAME_HEIGHT);

                if (gameState.isGameStarted) {
                    gem.update();

                    // Adjust difficulty based on score
                    const speedIncrease = Math.floor(gameState.score / 5) * 0.2; // Increase speed every 5 points
                    const currentSpeed = gameState.baseSpeed + speedIncrease;
                    
                    const intervalDecrease = Math.floor(gameState.score / 10) * 10; // Decrease interval every 10 points
                    const currentInterval = Math.max(60, gameState.initialInterval - intervalDecrease);

                    gameState.crystalTimer++;
                    if (gameState.crystalTimer >= currentInterval) {
                        const gapHeight = 100;
                        const gapY = Math.random() * (GAME_HEIGHT - gapHeight - 100) + 50;
                        gameState.crystals.push(new Crystal(GAME_WIDTH, gapY, gapHeight, 30, currentSpeed));
                        gameState.crystalTimer = 0;
                    }

                    gameState.crystals.forEach(crystal => {
                        crystal.update();
                        // Collision detection
                        if (
                            gem.x + gem.radius > crystal.x &&
                            gem.x - gem.radius < crystal.x + crystal.width
                        ) {
                            if (
                                gem.y - gem.radius < crystal.gapY ||
                                gem.y + gem.radius > crystal.gapY + crystal.gapHeight
                            ) {
                                gameState.isGameOver = true;
                            }
                        }

                        // Score update
                        if (
                            !crystal.isPassed &&
                            gem.x > crystal.x + crystal.width
                        ) {
                            crystal.isPassed = true;
                            gameState.score++;
                            scoreDisplay.textContent = gameState.score;
                        }
                    });

                    // Remove off-screen crystals
                    gameState.crystals = gameState.crystals.filter(crystal => crystal.x + crystal.width > 0);
                }

                // Draw everything
                gameState.crystals.forEach(crystal => crystal.draw());
                gem.draw();

                requestId = requestAnimationFrame(gameLoop);
            }

            // Event listeners for user input
            function handleInput() {
                if (!gameState.isGameStarted) {
                    gameState.isGameStarted = true;
                    messageBox.classList.add('hidden');
                    gameLoop();
                }
                if (!gameState.isGameOver) {
                    gem.velocity = gem.jumpPower;
                }
            }

            canvas.addEventListener('click', handleInput);
            document.addEventListener('keydown', (e) => {
                if (e.code === 'Space' || e.code === 'ArrowUp') {
                    e.preventDefault();
                    handleInput();
                }
            });
            restartButton.addEventListener('click', () => {
                messageBox.classList.add('hidden');
                gameState.reset();
                // Pass a new speed parameter to the crystals
                gameState.crystals = gameState.crystals.map(crystal => new Crystal(crystal.x, crystal.gapY, crystal.gapHeight, crystal.width, gameState.baseSpeed));
                gameLoop();
            });

            // Initial game state display
            function showStartMessage() {
                messageTitle.textContent = "Welcome to Flappy Gem";
                messageText.textContent = "Click or press Space to jump and start the game!";
                messageBox.classList.remove('hidden');
                scoreDisplay.textContent = "0";
            }
            
            showStartMessage();
        });
    </script>
</body>
</html>
