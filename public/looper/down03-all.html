<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Two Track Audio Recorder and Merger</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/recorderjs/0.1.0/recorder.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lamejs/1.2.1/lame.all.js"></script>
</head>
<body>
<h2>Record Two Tracks and Merge into One MP3</h2>
<div>
    <button onclick="startRecording(1)">Start Recording Track 1</button>
    <button onclick="stopRecording(1)">Stop Recording Track 1</button>
    <audio id="track1" controls></audio>
</div>
<div>
    <button onclick="startRecording(2)">Start Recording Track 2</button>
    <button onclick="stopRecording(2)">Stop Recording Track 2</button>
    <audio id="track2" controls></audio>
</div>
<button onclick="mergeAndDownload()">Merge Tracks and Download MP3</button>

<script>


let audioContext = new (window.AudioContext || window.webkitAudioContext)();
let recorders = {};
let gumStream = {}; // To hold the stream from getUserMedia

function startRecording(track) {
    navigator.mediaDevices.getUserMedia({audio: true})
        .then(stream => {
            gumStream[track] = stream; // Store the stream
            const input = audioContext.createMediaStreamSource(stream);
            const recorder = new Recorder(input, { numChannels: 1 });
            recorders[track] = recorder;
            recorder.record();
        }).catch(error => {
            console.error("Error accessing microphone: ", error);
        });
}

function stopRecording(track) {
    if (recorders[track]) {
        recorders[track].stop(); // Stop the recorder
        gumStream[track].getTracks().forEach(track => track.stop()); // Stop the getUserMedia stream

        // Create the WAV blob and set it as src of an audio element
        recorders[track].exportWAV(function(blob) {
            const url = URL.createObjectURL(blob);
            document.getElementById('track' + track).src = url;
        });
    }
}

function mergeAndDownload() {
    // This function remains mostly the same but needs adjustment if actual merging logic is implemented
}

    
</script>
</body>
</html>

